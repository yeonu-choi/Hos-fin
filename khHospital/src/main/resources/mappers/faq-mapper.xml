<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
"-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="faqMapper">
	<resultMap type="Faq" id="faqResultSet">
		<id property="fid" column="FID"/>
		<result property="ftitle" column="FTITLE"/>
		<result property="fcontent" column="FCONTENT"/>
		<result property="fcreatedate" column="F_CREATE_DATE"/>
		<result property="fmodifydate" column="F_MODIFY_DATE"/>
		<result property="fstatus" column="FSTATUS"/>
		<result property="did" column="DID"/>
		<result property="cid" column="CID"/>
		<result property="fwriter" column="FWRITER"/>
		<result property="dname" column="DNAME"/>
		<result property="cname" column="CNAME"/>
	</resultMap>
	<!-- select 에서 resultMap에 대항하는 데이터가 없거나 select문이 선택되지 않으면 알아서 null 값이 들어감-->
	<select id="selectListCount" resultType="_int">
		SELECT
			   COUNT(*)
		FROM
			   FAQ
		WHERE
			   FSTATUS = 'Y'
	</select>
	<select id="selectList" resultMap="faqResultSet">
		SELECT
			    FID
			  , FTITLE
			  , FCONTENT
			  , F_CREATE_DATE
			  , F_MODIFY_DATE
			  , FSTATUS
			  , DID
			  , CID
			  , FWRITER
		FROM 
		      FAQ
		WHERE
			  FSTATUS = 'Y'
		ORDER BY
			  FID DESC
	</select>
	<select id="insertFaq" parameterType="Faq">
		INSERT
		INTO FAQ
		(
			  FID
			, FTITLE
			, FCONTENT
			, F_CREATE_DATE
			, F_MODIFY_DATE
			, FSTATUS
			<if test='did &lt;= 16'>
			, DID
			</if>
			<if test='did &gt;= 30'>
			, CID
			</if>
			, FWRITER
		)
		VALUES
		(
			SEQ_FNO.NEXTVAL
			, #{ftitle}
			, #{fcontent}
			, SYSDATE
			, SYSDATE
			, DEFAULT
			<if test='did &lt;= 16'>
			, #{did}
			</if>
			<if test='did &gt;= 30'>
			, #{did}
			</if>
			, #{fwriter}
		)
	</select>
	<!-- 
		<if test='did &gt;= 30'>
			, #{did} 
		: 화면에 name태그가 did로 작성 되어 있었기 때문에 들어가는 values 에서 들어가는 값이 Department의 did와 같이  did로 설정해 주어야 한다 
	 -->
	<update id="updateReadCount" parameterType="_int">
			UPDATE
				  NOTICE
			SET
				  NCOUNT = NCOUNT + 1
			WHERE
				  NID = #{nid}  
	</update>
	<select id="selectFaq" parameterType="_int" resultMap="faqResultSet">
		SELECT
			    FID
			  , FTITLE
			  , FCONTENT
			  , F_CREATE_DATE
			  , F_MODIFY_DATE
			  , FSTATUS
			  , DID
			  , CID
			  , FWRITER
			  , DNAME
			  , CNAME
		FROM
			  FAQ
			  LEFT JOIN DEPARTMENT USING(DID)
			  LEFT JOIN MEDICAL_CENTER USING(CID)
		WHERE
			  FID = #{fid}
	</select>
	<select id="selectAdList" resultMap="faqResultSet">
		SELECT
			    FID
			  , FTITLE
			  , FCONTENT
			  , F_CREATE_DATE
			  , F_MODIFY_DATE
			  , FSTATUS
			  , DID
			  , CID
			  , FWRITER
			  , DNAME
			  , CNAME
		FROM 
		      FAQ
		      LEFT JOIN DEPARTMENT USING(DID)
			  LEFT JOIN MEDICAL_CENTER USING(CID)
		WHERE
			  FSTATUS = 'Y'
			  
		ORDER BY
			  FID DESC
			
	</select>
	<select id="updateFaq" parameterType="Faq">
		UPDATE
			    FAQ
		SET
			   FTITLE = #{ftitle}
			 , FCONTENT = #{fcontent}
			 , F_MODIFY_DATE = SYSDATE
			 <if test='did &lt;= 16'>
			 , DID = #{did}
			 </if>
			 <if test='did &gt;= 30'>
			 , CID = #{did}
			 </if>
		WHERE
			 FID = #{fid}
	</select>
	<select id="deleteFaq" parameterType="_int">
		DELETE
		FROM
			  FAQ
		WHERE
			  FID = #{fid}
	</select>
	<select id="searchList" parameterType="Search2" resultMap="faqResultSet">
	<bind name="s" value="'%' +_parameter.getSearchValue() + '%'"/>
		SELECT
			    FID
			  , FTITLE
			  , FCONTENT
			  , F_CREATE_DATE
			  , F_MODIFY_DATE
			  , FSTATUS
			  , DID
			  , CID
			  , FWRITER
			  , DNAME
			  , CNAME
		FROM 
		      FAQ
		      LEFT JOIN DEPARTMENT USING(DID)
			  LEFT JOIN MEDICAL_CENTER USING(CID)
		<where>
			<if test='did &lt;= 16'>
			<choose>
				<when test="searchCondition == 'title'">
				AND FTITLE LIKE #{s}
				</when>
				<when test="searchCondition == 'contents'">
				AND FCONTENT LIKE #{s}
				</when>
				<otherwise>
				AND (OR FTITLE LIKE #{s}
					 OR FCONTENT LIKE #{s})
				</otherwise>
			</choose>
			</if>
			<if test='did &gt;= 30'>
			<choose>
				<when test="searchCondition == 'title'">
				AND FTITLE LIKE #{s}
				</when>
				<when test="searchCondition == 'contents'">
				AND FCONTENT LIKE #{s}
				</when>
				<otherwise>
				AND (OR FTITLE LIKE #{s}
					 OR FCONTENT LIKE #{s})
				</otherwise>
			</choose>
			</if>
		</where>
		ORDER BY FID DESC
	</select>
	
	<select id="searchList2" parameterType="Search2" resultMap="faqResultSet">
	<bind name="s" value="'%' +_parameter.getSearchValue() + '%'"/>
		SELECT
			    FID
			  , FTITLE
			  , FCONTENT
			  , F_CREATE_DATE
			  , F_MODIFY_DATE
			  , FSTATUS
			  , DID
			  , CID
			  , FWRITER
			  , DNAME
			  , CNAME
		FROM 
		      FAQ
		      LEFT JOIN DEPARTMENT USING(DID)
			  LEFT JOIN MEDICAL_CENTER USING(CID)
		<where>
			<choose>
				<when test="searchId &gt;= 30">
				AND CID = #{searchId}
				</when>
				<otherwise>
				AND DID = #{searchId}
				</otherwise>
			</choose>
			<choose>
				<when test="searchCondition == 'title'">
				AND FTITLE LIKE #{s}
				</when>
				<when test="searchCondition == 'contents'">
				AND FCONTENT LIKE #{s}
				</when>
				<otherwise>
				AND ( FTITLE LIKE #{s}
					 OR FCONTENT LIKE #{s})
				</otherwise>
			</choose>
		</where>
		ORDER BY FID DESC
	</select> 
	
	<select id="searchListCount" resultType="_int" parameterType="search2">
	<bind name="s" value="'%' +_parameter.getSearchValue() + '%'"/>
		SELECT
			   COUNT(*)
		FROM 
		      FAQ
		      LEFT JOIN DEPARTMENT USING(DID)
			  LEFT JOIN MEDICAL_CENTER USING(CID)
		<where>
			<choose>
				<when test="searchId &gt;= 30">
				AND CID = #{searchId}
				</when>
				<otherwise>
				AND DID = #{searchId}
				</otherwise>
			</choose>
			<choose>
				<when test="searchCondition == 'title'">
				AND FTITLE LIKE #{s}
				</when>
				<when test="searchCondition == 'contents'">
				AND FCONTENT LIKE #{s}
				</when>
				<otherwise>
				AND ( FTITLE LIKE #{s}
					 OR FCONTENT LIKE #{s})
				</otherwise>
			</choose>
		</where>
		ORDER BY FID DESC
	</select>
</mapper>
<!-- listPage에서 searchId 값을 받아온 후 받아온 searchId의 진료과 넘버가 30이상일때 
	 1) searchId 값이 30이상인지 거른다
	 2) 30 이상이라면 가져온 searchId 값이 CID 와 같은 값이고 (=> if)
	 3) 30 이하라면 searchId의 값이 DID와 같은 값이다 (=> else if) 
	 => 카테고리를 걸렀다면 
	 4) searchCondition이 제목이라면 title
	 5) searchCondition이 내용이라면 contents
	 6) searchCondition이 전체라면 <otherwise> 를 통해 전체 -->



















